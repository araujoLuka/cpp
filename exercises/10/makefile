# Lucas Correia de Araujo - GRR 20206150
# Exercise 4 - Object-Oriented Programming C++
# Makefile to "Person and Discipline Class" program
#
# Teacher: Paulo Ricardo Lisboa de Almeida
#
# August 2023
# Rules:  all ; debug ; tests ; tar ; clean ; purge
#
# Program name: aula

# Make variables
CC = g++
CFLAGS = -Wall
OBJECTS = $(patsubst %.cpp, %.o, $(wildcard *.cpp))
TARFILES = $(wildcard *.cpp) $(wildcard *.hpp) makefile $(wildcard README.md)
PROGRAM = aula

# ELF object files rule
%.o: %.cpp
	$(CC) -o $@ -c $< $(CXXFLAGS)

# Main rule
all: $(PROGRAM)
$(PROGRAM): $(OBJECTS)
	$(CC) -o $@ $(OBJECTS) $(CXXFLAGS)

# Rule to always rebuild with make command
.PHONY: all

# Tar rule
tar: D := $(lastword $(subst /, ,$(abspath ./)))
tar: 
	mkdir -p tmp 
	cp $(TARFILES) tmp/
	tar -czvf exerc$(D).tar.gz $(patsubst ./tmp/%, %, $(wildcard ./tmp/*))
	rm -r tmp/

# Rule to clean temporary files
clean:
	-rm -fr tmp/
	-rm -f $(OBJECTS) *.tar.gz

# Rule to clean all files generated by make
purge: clean
	-rm -f $(PROGRAM)
